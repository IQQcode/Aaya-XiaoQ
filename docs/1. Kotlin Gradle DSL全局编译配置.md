**gradle task --all**

**gradlew ass**

> 官方文档🎨 https://docs.gradle.org/current/userguide/kotlin_dsl.html

### 全局编译配置

**setting.gradle.kts**


- Include/插入Module编译项
- rootProject.name/项目名称
- rootProject.buildFileName/指定Gradle编译配置文件

```kotlin
include(":app")
rootProject.name = "XiaoQ"
rootProject.buildFileName = "build.gradle.kts"
```



### 项目配置

**build.gradle.kts**

- Kotlin 语法重写
- buildscript/编译配置
- allprojects/应用配置
- tasks/任务

```kotlin
// Top-level build file where you can add configuration options common to all sub-projects/modules.
buildscript {

    repositories {
        google()
        jcenter()
    }
    dependencies {
        classpath("com.android.tools.build:gradle:${KotlinConstants.gradle_version}")
        classpath("org.jetbrains.kotlin:kotlin-gradle-plugin:${KotlinConstants.kotlin_version}")

        // NOTE: Do not place your application dependencies here; they belong
        // in the individual module build.gradle files
    }
}

allprojects {
    repositories {
        google()
        jcenter()
    }
}

tasks {
    val clean by registering(Delete::class) {
        delete(buildDir)
    }
}
```





### 主工程app配置

- plugins/插件
- android/Android配置
- dependencies/依赖项

```
android
   - defaultConfig 默认配置
   - signingConfigs 签名配置
   - applicationVariants APK输出类型
   - buildTypes 编译类型
   - compileOptions 依赖操作
   - buildFeatures 视图绑定
```

配置内容如下

```kotlin
// 引用插件
plugins {
    id("com.android.application")
    kotlin("android")
    kotlin("android.extensions")
}

// Android属性
android {
    compileSdkVersion(30)
    buildToolsVersion("30.0.3")

    defaultConfig {
        applicationId = "top.iqqcode.xiaoq"
        minSdkVersion(21)
        targetSdkVersion(30)
        versionCode = 1
        versionName = "1.0"

        testInstrumentationRunner = "androidx.test.runner.AndroidJUnitRunner"
    }

    // 签名配置
    signingConfigs {
        register("release") {
            //别名
            keyAlias = "iqqcode"
            //别名密码
            keyPassword = "gk2017jh"
            //路径
            storeFile = file("/src/main/jks/xiaoq.jks")
            //密码
            storePassword = "gk2017jh"
        }
    }

    // 输出类型
    android.applicationVariants.all {
        //编译类型
        val buildType = this.buildType.name
        outputs.all {
            //输出APK
            if (this is com.android.build.gradle.internal.api.ApkVariantOutputImpl) {
                if (buildType == "release") {
                    this.outputFileName = "XiaoQ_V${defaultConfig.versionName}_$buildType.apk"
                }
            }
        }
    }


    // 编译类型
    buildTypes {
        getByName("debug") {

        }

        getByName("release") {
            isMinifyEnabled = false
            proguardFiles(
                getDefaultProguardFile("proguard-android-optimize.txt"),
                "proguard-rules.pro"
            )
        }
    }

    // 视图绑定
    buildFeatures {
        viewBinding = true
    }

    //依赖操作
    compileOptions {
        sourceCompatibility = JavaVersion.VERSION_1_8
        targetCompatibility = JavaVersion.VERSION_1_8
    }
    kotlinOptions {
        jvmTarget = "1.8"
    }
}

dependencies {

    implementation(DependenciesConfig.STD_LIB)
    implementation(DependenciesConfig.KTX_CORE)
    implementation(DependenciesConfig.APP_COMPAT)
    implementation(DependenciesConfig.MATERIAL)
    androidTestImplementation(DependenciesConfig.AndroidTestImplementation)
}
```





### DSL编译文件

新建buildSrc模块(不是新建Module，而是创建buildSrc文件夹)



![image-20210414130111834](https://iqqcode-blog.oss-cn-beijing.aliyuncs.com/img-2021-befo/20210414130113.png)

- buildSrc / config module
- settings.gradle.kts/配置项
- project/build.gradle.kts/编译项
- 配置文件编写



**KotlinConstants.kt** 提供常量供全局引用

```kotlin
// 全局常量
object KotlinConstants {

    //Gradle 版本
    const val gradle_version = "4.1.3"

    //Kotlin 版本
    const val kotlin_version = "1.4.32"
}

// 应用配置
object AppConfig {

    //依赖版本
    const val compileSdkVersion = 30

    //编译工具版本
    const val buildToolsVersion = "30.0.3"

    //包名
    const val applicationId = "top.iqqcode.xiaoq"

    //最小支持SDK
    const val minSdkVersion = 21

    //当前基于SDK
    const val targetSdkVersion = 30

    //版本编码
    const val versionCode = 1

    //版本名称
    const val versionName = "1.0"
}

//依赖配置
object DependenciesConfig {

    //Kotlin基础库
    const val STD_LIB = "org.jetbrains.kotlin:kotlin-stdlib:${KotlinConstants.kotlin_version}"

    //Android标准库
    const val APP_COMPAT = "androidx.appcompat:appcompat:1.2.0"

    //Kotlin核心库
    const val KTX_CORE = "androidx.core:core-ktx:1.3.2"

    // androidTestImplementation

    const val AndroidTestImplementation = "androidx.test.espresso:espresso-core:3.3.0"

    //EventBus
    const val EVENT_BUS = "org.greenrobot:eventbus:3.2.0"

    //ARouter
    const val AROUTER = "com.alibaba:arouter-api:1.5.0"
    const val AROUTER_COMPILER = "com.alibaba:arouter-compiler:1.2.2"

    //RecyclerView
    const val RECYCLERVIEW = "androidx.recyclerview:recyclerview:1.2.0-alpha01"

    //Permissions
    const val AND_PERMISSIONS = "com.yanzhenjie:permission:2.0.3"

    //Retrofit
    const val RETROFIT = "com.squareup.retrofit2:retrofit:2.8.1"
    const val RETROFIT_GSON = "com.squareup.retrofit2:converter-gson:2.8.1"

    //ViewPager
    const val VIEWPAGER = "com.zhy:magic-viewpager:1.0.1"
    const val MATERIAL = "com.google.android.material:material:1.3.0"

    //Lottie
    const val LOTTIE = "com.airbnb.android:lottie:3.4.0"

    //刷新
    const val REFRESH_KERNEL = "com.scwang.smart:refresh-layout-kernel:2.0.1"
    const val REFRESH_HEADER = "com.scwang.smart:refresh-header-classics:2.0.1"
    const val REFRESH_FOOT = "com.scwang.smart:refresh-footer-classics:2.0.1"

    //图表
    const val CHART = "com.github.PhilJay:MPAndroidChart:v3.1.0"
}
```

**build.gradle.kts**

```kotlin
apply {
    plugin("kotlin")
}

buildscript {
    repositories {
        gradlePluginPortal()
    }
    dependencies {
        classpath(kotlin("gradle-plugin", "1.4.32"))
    }
}

dependencies {
    implementation(gradleKotlinDsl())
    implementation(kotlin("stdlib", "1.4.32"))
}

repositories {
    gradlePluginPortal()
}
```

**settings.gradle.kts**

```kotlin
rootProject.buildFileName = "build.gradle.kts"
```

