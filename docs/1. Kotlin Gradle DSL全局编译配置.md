**gradle task --all**

**gradlew ass**

> å®˜æ–¹æ–‡æ¡£ğŸ¨ https://docs.gradle.org/current/userguide/kotlin_dsl.html

### å…¨å±€ç¼–è¯‘é…ç½®

**setting.gradle.kts**


- Include/æ’å…¥Moduleç¼–è¯‘é¡¹
- rootProject.name/é¡¹ç›®åç§°
- rootProject.buildFileName/æŒ‡å®šGradleç¼–è¯‘é…ç½®æ–‡ä»¶

```kotlin
include(":app")
rootProject.name = "XiaoQ"
rootProject.buildFileName = "build.gradle.kts"
```



### é¡¹ç›®é…ç½®

**build.gradle.kts**

- Kotlin è¯­æ³•é‡å†™
- buildscript/ç¼–è¯‘é…ç½®
- allprojects/åº”ç”¨é…ç½®
- tasks/ä»»åŠ¡

```kotlin
// Top-level build file where you can add configuration options common to all sub-projects/modules.
buildscript {

    repositories {
        google()
        jcenter()
    }
    dependencies {
        classpath("com.android.tools.build:gradle:${KotlinConstants.gradle_version}")
        classpath("org.jetbrains.kotlin:kotlin-gradle-plugin:${KotlinConstants.kotlin_version}")

        // NOTE: Do not place your application dependencies here; they belong
        // in the individual module build.gradle files
    }
}

allprojects {
    repositories {
        google()
        jcenter()
    }
}

tasks {
    val clean by registering(Delete::class) {
        delete(buildDir)
    }
}
```





### ä¸»å·¥ç¨‹appé…ç½®

- plugins/æ’ä»¶
- android/Androidé…ç½®
- dependencies/ä¾èµ–é¡¹

```
android
   - defaultConfig é»˜è®¤é…ç½®
   - signingConfigs ç­¾åé…ç½®
   - applicationVariants APKè¾“å‡ºç±»å‹
   - buildTypes ç¼–è¯‘ç±»å‹
   - compileOptions ä¾èµ–æ“ä½œ
   - buildFeatures è§†å›¾ç»‘å®š
```

é…ç½®å†…å®¹å¦‚ä¸‹

```kotlin
// å¼•ç”¨æ’ä»¶
plugins {
    id("com.android.application")
    kotlin("android")
    kotlin("android.extensions")
}

// Androidå±æ€§
android {
    compileSdkVersion(30)
    buildToolsVersion("30.0.3")

    defaultConfig {
        applicationId = "top.iqqcode.xiaoq"
        minSdkVersion(21)
        targetSdkVersion(30)
        versionCode = 1
        versionName = "1.0"

        testInstrumentationRunner = "androidx.test.runner.AndroidJUnitRunner"
    }

    // ç­¾åé…ç½®
    signingConfigs {
        register("release") {
            //åˆ«å
            keyAlias = "iqqcode"
            //åˆ«åå¯†ç 
            keyPassword = "gk2017jh"
            //è·¯å¾„
            storeFile = file("/src/main/jks/xiaoq.jks")
            //å¯†ç 
            storePassword = "gk2017jh"
        }
    }

    // è¾“å‡ºç±»å‹
    android.applicationVariants.all {
        //ç¼–è¯‘ç±»å‹
        val buildType = this.buildType.name
        outputs.all {
            //è¾“å‡ºAPK
            if (this is com.android.build.gradle.internal.api.ApkVariantOutputImpl) {
                if (buildType == "release") {
                    this.outputFileName = "XiaoQ_V${defaultConfig.versionName}_$buildType.apk"
                }
            }
        }
    }


    // ç¼–è¯‘ç±»å‹
    buildTypes {
        getByName("debug") {

        }

        getByName("release") {
            isMinifyEnabled = false
            proguardFiles(
                getDefaultProguardFile("proguard-android-optimize.txt"),
                "proguard-rules.pro"
            )
        }
    }

    // è§†å›¾ç»‘å®š
    buildFeatures {
        viewBinding = true
    }

    //ä¾èµ–æ“ä½œ
    compileOptions {
        sourceCompatibility = JavaVersion.VERSION_1_8
        targetCompatibility = JavaVersion.VERSION_1_8
    }
    kotlinOptions {
        jvmTarget = "1.8"
    }
}

dependencies {

    implementation(DependenciesConfig.STD_LIB)
    implementation(DependenciesConfig.KTX_CORE)
    implementation(DependenciesConfig.APP_COMPAT)
    implementation(DependenciesConfig.MATERIAL)
    androidTestImplementation(DependenciesConfig.AndroidTestImplementation)
}
```





### DSLç¼–è¯‘æ–‡ä»¶

æ–°å»ºbuildSrcæ¨¡å—(ä¸æ˜¯æ–°å»ºModuleï¼Œè€Œæ˜¯åˆ›å»ºbuildSrcæ–‡ä»¶å¤¹)



![image-20210414130111834](https://iqqcode-blog.oss-cn-beijing.aliyuncs.com/img-2021-befo/20210414130113.png)

- buildSrc / config module
- settings.gradle.kts/é…ç½®é¡¹
- project/build.gradle.kts/ç¼–è¯‘é¡¹
- é…ç½®æ–‡ä»¶ç¼–å†™



**KotlinConstants.kt** æä¾›å¸¸é‡ä¾›å…¨å±€å¼•ç”¨

```kotlin
// å…¨å±€å¸¸é‡
object KotlinConstants {

    //Gradle ç‰ˆæœ¬
    const val gradle_version = "4.1.3"

    //Kotlin ç‰ˆæœ¬
    const val kotlin_version = "1.4.32"
}

// åº”ç”¨é…ç½®
object AppConfig {

    //ä¾èµ–ç‰ˆæœ¬
    const val compileSdkVersion = 30

    //ç¼–è¯‘å·¥å…·ç‰ˆæœ¬
    const val buildToolsVersion = "30.0.3"

    //åŒ…å
    const val applicationId = "top.iqqcode.xiaoq"

    //æœ€å°æ”¯æŒSDK
    const val minSdkVersion = 21

    //å½“å‰åŸºäºSDK
    const val targetSdkVersion = 30

    //ç‰ˆæœ¬ç¼–ç 
    const val versionCode = 1

    //ç‰ˆæœ¬åç§°
    const val versionName = "1.0"
}

//ä¾èµ–é…ç½®
object DependenciesConfig {

    //KotlinåŸºç¡€åº“
    const val STD_LIB = "org.jetbrains.kotlin:kotlin-stdlib:${KotlinConstants.kotlin_version}"

    //Androidæ ‡å‡†åº“
    const val APP_COMPAT = "androidx.appcompat:appcompat:1.2.0"

    //Kotlinæ ¸å¿ƒåº“
    const val KTX_CORE = "androidx.core:core-ktx:1.3.2"

    // androidTestImplementation

    const val AndroidTestImplementation = "androidx.test.espresso:espresso-core:3.3.0"

    //EventBus
    const val EVENT_BUS = "org.greenrobot:eventbus:3.2.0"

    //ARouter
    const val AROUTER = "com.alibaba:arouter-api:1.5.0"
    const val AROUTER_COMPILER = "com.alibaba:arouter-compiler:1.2.2"

    //RecyclerView
    const val RECYCLERVIEW = "androidx.recyclerview:recyclerview:1.2.0-alpha01"

    //Permissions
    const val AND_PERMISSIONS = "com.yanzhenjie:permission:2.0.3"

    //Retrofit
    const val RETROFIT = "com.squareup.retrofit2:retrofit:2.8.1"
    const val RETROFIT_GSON = "com.squareup.retrofit2:converter-gson:2.8.1"

    //ViewPager
    const val VIEWPAGER = "com.zhy:magic-viewpager:1.0.1"
    const val MATERIAL = "com.google.android.material:material:1.3.0"

    //Lottie
    const val LOTTIE = "com.airbnb.android:lottie:3.4.0"

    //åˆ·æ–°
    const val REFRESH_KERNEL = "com.scwang.smart:refresh-layout-kernel:2.0.1"
    const val REFRESH_HEADER = "com.scwang.smart:refresh-header-classics:2.0.1"
    const val REFRESH_FOOT = "com.scwang.smart:refresh-footer-classics:2.0.1"

    //å›¾è¡¨
    const val CHART = "com.github.PhilJay:MPAndroidChart:v3.1.0"
}
```

**build.gradle.kts**

```kotlin
apply {
    plugin("kotlin")
}

buildscript {
    repositories {
        gradlePluginPortal()
    }
    dependencies {
        classpath(kotlin("gradle-plugin", "1.4.32"))
    }
}

dependencies {
    implementation(gradleKotlinDsl())
    implementation(kotlin("stdlib", "1.4.32"))
}

repositories {
    gradlePluginPortal()
}
```

**settings.gradle.kts**

```kotlin
rootProject.buildFileName = "build.gradle.kts"
```

